<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Market Kart - Modern E-Commerce</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    /*
     * Global Styles & CSS Variables
     */
    :root {
      --color-primary: #007bff;
      --color-primary-dark: #0056b3;
      --color-secondary: #e0245e;
      --color-text-dark: #333;
      --color-text-light: #666;
      --color-background: #f8f9fa;
      --color-card-background: #fff;
      --color-border: #ddd;
      --font-family-body: 'Poppins', sans-serif;
      --box-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --box-shadow-md: 0 4px 10px rgba(0, 0, 0, 0.1);
      --border-radius-card: 8px;
      --border-radius-btn: 6px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font-family-body);
      background: var(--color-background);
      color: var(--color-text-dark);
      line-height: 1.6;
    }

    a, button {
      cursor: pointer;
      font-family: inherit;
    }

    header {
      background: var(--color-text-dark);
      color: var(--color-background);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1.5rem;
      box-shadow: var(--box-shadow-md);
    }

    header h1 {
      font-weight: 700;
      font-size: 1.8rem;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .header-actions button {
      background: var(--color-primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius-btn);
      font-weight: 600;
      transition: background-color 0.2s ease-in-out;
    }

    .header-actions button:hover,
    .header-actions button:focus {
      background: var(--color-primary-dark);
      outline: none;
    }

    /* Search Bar */
    .search-container {
      position: relative;
      flex: 1 1 300px;
    }

    #search-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius-btn);
      border: 1px solid var(--color-border);
      font-size: 1rem;
    }

    #search-input:focus {
      outline: 2px solid var(--color-primary);
      border-color: var(--color-primary);
    }

    #suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--color-card-background);
      border: 1px solid var(--color-border);
      border-top: none;
      border-radius: 0 0 var(--border-radius-btn) var(--border-radius-btn);
      max-height: 250px;
      overflow-y: auto;
      display: none;
      z-index: 10;
      box-shadow: var(--box-shadow-sm);
    }

    #suggestions div {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    #suggestions div:hover,
    #suggestions div:focus {
      background: var(--color-primary);
      color: white;
      outline: none;
    }

    /* Filters */
    #filters {
      background: var(--color-card-background);
      padding: 1.5rem 2rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
      border-bottom: 1px solid var(--color-border);
    }

    #category-filter label {
      margin-right: 1.5rem;
      cursor: pointer;
    }

    #price-filter {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #price-value {
      font-weight: 600;
      color: var(--color-primary);
    }

    /* Product Grid */
    #product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 2rem;
      padding: 2rem;
    }

    .product-card {
      background: var(--color-card-background);
      border-radius: var(--border-radius-card);
      box-shadow: var(--box-shadow-sm);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .product-card:hover,
    .product-card:focus-within {
      transform: translateY(-5px);
      box-shadow: var(--box-shadow-md);
    }

    .product-card img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
    }

    .product-info {
      padding: 1rem;
      flex-grow: 1;
    }

    .product-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .product-category {
      font-size: 0.875rem;
      color: var(--color-text-light);
      margin-bottom: 0.5rem;
    }

    .product-price {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--color-primary);
    }

    .card-actions {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 1rem 1rem;
      gap: 0.5rem;
    }

    .btn {
      border: none;
      background: var(--color-primary);
      color: white;
      padding: 0.75rem 1.25rem;
      border-radius: var(--border-radius-btn);
      font-size: 1rem;
      font-weight: 600;
      transition: background-color 0.2s ease-in-out;
    }

    .btn:hover,
    .btn:focus-visible {
      background: var(--color-primary-dark);
      outline: none;
    }

    .btn-wishlist {
      background: transparent;
      color: var(--color-border);
      font-size: 1.5rem;
      padding: 0;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease-in-out;
    }

    .btn-wishlist.active {
      color: var(--color-secondary);
    }

    .btn-wishlist:hover,
    .btn-wishlist:focus-visible {
      color: var(--color-secondary);
      outline: none;
    }

    /* Modals */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
      overflow-y: auto;
      padding: 1rem;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: var(--color-card-background);
      border-radius: var(--border-radius-card);
      max-width: 500px;
      width: 100%;
      max-height: 95vh;
      overflow-y: auto;
      box-shadow: var(--box-shadow-md);
      position: relative;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem;
      border-bottom: 1px solid var(--color-border);
    }

    .modal-header h3 {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .modal-close {
      background: transparent;
      border: none;
      font-size: 2rem;
      line-height: 1;
      color: var(--color-text-light);
      cursor: pointer;
      transition: color 0.2s ease-in-out;
    }

    .modal-close:hover,
    .modal-close:focus {
      color: var(--color-primary);
      outline: none;
    }

    .quickview-details {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .quickview-addcart {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      margin-top: auto;
    }

    #quickview-qty {
      width: 80px;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-btn);
      text-align: center;
    }

    #quickview-addcart-btn {
      flex-grow: 1;
      font-weight: 700;
    }

    /* Cart & Wishlist */
    .cart-items, .wishlist-list {
      padding: 1.25rem;
      max-height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .cart-item, .wishlist-item {
      display: flex;
      gap: 1rem;
      align-items: center;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }

    .cart-item img, .wishlist-item img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: var(--border-radius-btn);
    }

    .cart-item-info, .wishlist-item-info {
      flex-grow: 1;
    }

    .cart-item-info h4, .wishlist-item-info h4 {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .cart-item-info p {
      font-size: 0.9rem;
      color: var(--color-text-light);
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .cart-item-controls input {
      width: 60px;
      padding: 0.3rem 0.5rem;
      border: 1px solid var(--color-border);
      border-radius: var(--border-radius-btn);
      text-align: center;
    }

    .cart-item-controls button, .wishlist-item button {
      background: transparent;
      border: none;
      color: var(--color-secondary);
      font-size: 1.2rem;
      transition: color 0.2s ease-in-out;
    }

    .cart-item-controls button:hover, .wishlist-item button:hover {
      color: #b0003b;
    }

    .cart-summary {
      padding: 1.5rem;
      border-top: 1px solid var(--color-border);
      font-weight: 700;
      font-size: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .cart-summary p {
      display: flex;
      justify-content: space-between;
    }

    .payment-options {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-top: 1rem;
    }

    .payment-options button {
        padding: 0.75rem 1rem;
        font-weight: 600;
        background: var(--color-primary);
        color: white;
        border: none;
        border-radius: var(--border-radius-btn);
        transition: background-color 0.2s ease;
    }

    .payment-options button:hover {
        background: var(--color-primary-dark);
    }

    #payment-status-message {
        margin-top: 1rem;
        font-weight: 600;
        text-align: center;
        min-height: 1.2rem;
    }
    
    .login-form, .signup-form, .contact-form {
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
      gap: 1.25rem;
    }

    .login-form label, .signup-form label, .contact-form label {
      font-weight: 600;
    }

    .login-form input, .signup-form input, .contact-form input, .contact-form textarea {
      padding: 0.75rem 1rem;
      border-radius: var(--border-radius-btn);
      border: 1px solid var(--color-border);
      font-size: 1rem;
    }

    .login-form input:focus, .signup-form input:focus, .contact-form input:focus, .contact-form textarea:focus {
      outline: 2px solid var(--color-primary);
    }
    
    .login-form button, .signup-form button, .contact-form button {
      padding: 0.75rem 1rem;
      background: var(--color-primary);
      color: white;
      font-weight: 700;
      border: none;
      border-radius: var(--border-radius-btn);
    }
    
    .form-link {
        font-size: 0.9rem;
        text-align: center;
        color: var(--color-primary);
        cursor: pointer;
        text-decoration: underline;
    }

    /* Floating Cart Button */
    #floating-cart-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--color-primary);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      color: white;
      font-size: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
      z-index: 1000;
    }

    #floating-cart-btn:hover, #floating-cart-btn:focus {
      transform: scale(1.05);
      background: var(--color-primary-dark);
      outline: none;
    }

    #floating-cart-btn .badge {
      position: absolute;
      top: 5px;
      right: 5px;
      background: var(--color-secondary);
      min-width: 22px;
      height: 22px;
      border-radius: 50%;
      font-size: 0.8rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 2px;
    }
    
    /* QR Scanner Modal Specifics */
    #qr-scanner-modal .modal {
        max-width: 350px;
        text-align: center;
    }
    
    #qr-scanner-modal .modal-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1.5rem;
    }

    #qr-code-img {
        width: 200px;
        height: 200px;
        border: 1px solid var(--color-border);
        margin-bottom: 1rem;
        object-fit: cover;
    }
    
    #qr-scanner-modal .qr-sim-message {
        font-weight: 600;
    }
    
    #qr-timer {
        font-weight: 700;
        color: var(--color-secondary);
        font-size: 1.2rem;
    }

    /* Contact Success Modal Specifics */
    #contact-success-modal .modal {
      max-width: 400px;
      text-align: center;
    }
    
    #contact-success-modal .modal-content {
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    
    #contact-success-modal .modal-content h3 {
      color: var(--color-primary);
      font-size: 1.5rem;
    }
    
    #contact-success-modal .modal-content p {
      font-size: 1rem;
    }
    
    /* Card Payment Modal */
    #card-modal .modal {
        max-width: 400px;
    }
    
    .card-form {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .card-form .card-row {
        display: flex;
        gap: 1rem;
    }
    
    .card-form .card-row > div {
        flex: 1;
    }
    
    .card-form input {
      width: 100%;
    }
    
    /* Accessibility helper */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      margin: -1px;
      padding: 0;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: stretch;
      }
      .header-actions {
        justify-content: space-around;
      }
      #filters {
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
      }
      .product-card {
        max-width: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Market Kart</h1>
    <div class="search-container" role="search">
      <label for="search-input" class="visually-hidden">Search products</label>
      <input
        type="search"
        id="search-input"
        placeholder="Search products..."
        autocomplete="off"
        aria-autocomplete="list"
        aria-controls="suggestions"
        aria-haspopup="listbox"
      />
      <div id="suggestions" role="listbox" aria-label="Search suggestions"></div>
    </div>
    <div class="header-actions">
      <button id="wishlist-btn" aria-label="Open wishlist" aria-haspopup="dialog" aria-controls="wishlist-modal">
        Wishlist (<span id="wishlist-count">0</span>)
      </button>
      <button id="cart-btn" aria-label="Open cart" aria-haspopup="dialog" aria-controls="cart-modal">
        Cart (<span id="cart-count">0</span>)
      </button>
      <button id="login-btn" aria-label="Login or sign up">
        Login
      </button>
      <button id="contact-btn" aria-label="Contact Us">
        Contact Us
      </button>
    </div>
  </header>

  <section id="filters" aria-label="Product filters">
    <div id="category-filter" role="group" aria-labelledby="category-filter-label">
      <h3 id="category-filter-label" style="margin-bottom:0.5rem;">Category</h3>
      <label><input type="checkbox" value="Electronics" /> Electronics</label>
      <label><input type="checkbox" value="Clothing" /> Clothing</label>
      <label><input type="checkbox" value="Home" /> Home</label>
      <label><input type="checkbox" value="Books" /> Books</label>
    </div>
    <div id="price-filter" role="group" aria-labelledby="price-filter-label">
      <h3 id="price-filter-label">Max Price: <span id="price-value">$500</span></h3>
      <input type="range" id="price-range" min="0" max="500" value="500" step="5" />
    </div>
  </section>

  <main>
    <section id="product-grid" aria-live="polite" aria-label="Product list">
    </section>
  </main>

  <div class="modal-backdrop" id="quickview-modal" role="dialog" aria-modal="true" aria-labelledby="quickview-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="quickview-title">Product Title</h3>
        <button class="modal-close" aria-label="Close Quick View">&times;</button>
      </div>
      <img src="" alt="" class="quickview-img" />
      <div class="quickview-details">
        <p><strong id="quickview-category"></strong></p>
        <p id="quickview-description"></p>
        <p class="price" id="quickview-price"></p>
        <div class="quickview-addcart">
          <label for="quickview-qty" class="visually-hidden">Quantity</label>
          <input type="number" id="quickview-qty" min="1" value="1" aria-label="Quantity" />
          <button id="quickview-addcart-btn" class="btn">Add to Cart</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="wishlist-modal" role="dialog" aria-modal="true" aria-labelledby="wishlist-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="wishlist-title">Your Wishlist</h3>
        <button class="modal-close" aria-label="Close Wishlist">&times;</button>
      </div>
      <div class="wishlist-list" tabindex="0" aria-live="polite" aria-relevant="additions removals">
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="cart-modal" role="dialog" aria-modal="true" aria-labelledby="cart-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="cart-title">Your Cart</h3>
        <button class="modal-close" aria-label="Close Cart">&times;</button>
      </div>
      <div class="cart-items" tabindex="0" aria-live="polite" aria-relevant="additions removals">
      </div>
      <div class="cart-summary">
        <p>Total: $<span id="cart-total">0.00</span></p>
        <div class="payment-options">
          <button id="card-pay-btn" class="btn">Pay with Card</button>
          <button id="qr-pay-btn" class="btn">Pay with QR Code</button>
        </div>
        <p id="payment-status-message" role="alert" aria-live="assertive"></p>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="login-modal" role="dialog" aria-modal="true" aria-labelledby="login-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="login-title">Login</h3>
        <button class="modal-close" aria-label="Close Login">&times;</button>
      </div>
      <form class="login-form" id="login-form" novalidate>
        <label for="login-username">Username</label>
        <input type="text" id="login-username" name="username" autocomplete="username" required />
        <label for="login-password">Password</label>
        <input type="password" id="login-password" name="password" autocomplete="current-password" required />
        <button type="submit" class="btn">Login</button>
        <p class="login-error" role="alert" aria-live="assertive"></p>
        <p class="form-link" id="show-signup">New user? Sign Up</p>
      </form>
    </div>
  </div>

  <div class="modal-backdrop" id="signup-modal" role="dialog" aria-modal="true" aria-labelledby="signup-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="signup-title">Create Account</h3>
        <button class="modal-close" aria-label="Close Sign Up">&times;</button>
      </div>
      <form class="signup-form" id="signup-form" novalidate>
        <label for="signup-email">Email Address</label>
        <input type="email" id="signup-email" name="email" required />
        <label for="signup-username">Username</label>
        <input type="text" id="signup-username" name="username" required />
        <label for="signup-password">Password</label>
        <input type="password" id="signup-password" name="password" required />
        <label for="signup-confirm-password">Confirm Password</label>
        <input type="password" id="signup-confirm-password" name="confirm-password" required />
        <button type="submit" class="btn">Sign Up</button>
        <p class="signup-error" role="alert" aria-live="assertive"></p>
        <p class="form-link" id="show-login">Already have an account? Login</p>
      </form>
    </div>
  </div>
  
  <div class="modal-backdrop" id="contact-modal" role="dialog" aria-modal="true" aria-labelledby="contact-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="contact-title">Contact Us</h3>
        <button class="modal-close" aria-label="Close Contact Form">&times;</button>
      </div>
      <form class="contact-form" id="contact-form" novalidate>
        <label for="contact-name">Your Name</label>
        <input type="text" id="contact-name" name="name" required />
        <label for="contact-email">Your Email</label>
        <input type="email" id="contact-email" name="email" required />
        <label for="contact-message">Message</label>
        <textarea id="contact-message" name="message" rows="5" required></textarea>
        <button type="submit" class="btn">Send Message</button>
      </form>
    </div>
  </div>
  
  <div class="modal-backdrop" id="message-modal" role="dialog" aria-modal="true" aria-labelledby="message-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="message-title">Notification</h3>
        <button class="modal-close" aria-label="Close notification">&times;</button>
      </div>
      <div class="modal-content">
        <p id="message-text"></p>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="qr-scanner-modal" role="dialog" aria-modal="true" aria-labelledby="qr-scanner-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="qr-scanner-title">Scan to Pay</h3>
        <button class="modal-close" aria-label="Close QR Scanner">&times;</button>
      </div>
      <div class="modal-content">
        <img id="qr-code-img" src="https://www.activebarcode.com/codes/imagesmainexample/qrcode.gif" alt="QR Code for Payment" />
        <p class="qr-sim-message">Scan the QR code to complete your payment.</p>
        <p id="qr-timer">Time remaining: 30 seconds</p>
      </div>
    </div>
  </div>
  
  <div class="modal-backdrop" id="card-modal" role="dialog" aria-modal="true" aria-labelledby="card-title" tabindex="-1" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <h3 id="card-title">Card Details</h3>
        <button class="modal-close" aria-label="Close Card Form">&times;</button>
      </div>
      <form class="card-form" id="card-form" novalidate>
        <label for="card-number">Card Number</label>
        <input type="text" id="card-number" placeholder="XXXX XXXX XXXX XXXX" required />
        <label for="card-holder-name">Card Holder Name</label>
        <input type="text" id="card-holder-name" required />
        <div class="card-row">
            <div>
                <label for="expiry-date">Expiry Date</label>
                <input type="text" id="expiry-date" placeholder="MM/YY" required />
            </div>
            <div>
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" placeholder="XXX" required />
            </div>
        </div>
        <button type="submit" class="btn">Submit Payment</button>
      </form>
    </div>
  </div>

  <button id="floating-cart-btn" aria-label="Open cart" aria-haspopup="dialog" aria-controls="cart-modal">
    üõí
    <span class="badge" id="floating-cart-count" aria-live="polite" aria-atomic="true">0</span>
  </button>

  <script>
    (() => {
      // Sample products (could be fetched from an API)
      const products = [
        {
          id: 'p1',
          title: 'Wireless Headphones',
          category: 'Electronics',
          price: 120,
          image: 'https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcTtHSdkOMBxfJdBcUpI-yomlvwWtYAivhiOFPmdrux3bQuTgCLpLZpwf2ewGHRndZ2YopF2Uo2p69u0xrr45QudcML5lliRrPKnq_qLMj0rK28D1M6arddu',
          description: 'High-quality wireless headphones with noise cancellation for an immersive audio experience. Enjoy crystal-clear sound and a comfortable, lightweight design. Perfect for travel and daily use.',
        },
        {
          id: 'p2',
          title: 'Smartwatch',
          category: 'Electronics',
          price: 200,
          image: 'https://imageio.forbes.com/specials-images/imageserve/68962c03ea781a8de4781497/0x0.jpg?format=jpg&height=900&width=1600&fit=bounds',
          description: 'A stylish smartwatch that tracks your health and fitness goals. Features include a heart rate monitor, step counter, and notification alerts. Stay connected on the go.',
        },
        {
          id: 'p3',
          title: 'Men\'s Jacket',
          category: 'Clothing',
          price: 75,
          image: 'https://static.aceomni.cmsaceturtle.com/prod/product-image/aceomni/Wrangler/Monobrand/WMJK005313/WMJK005313_1.jpg',
          description: 'A versatile and stylish jacket for men. Made from durable, water-resistant material, it\'s perfect for transitional weather and adds a smart look to any outfit.',
        },
        {
          id: 'p4',
          title: 'Women\'s Dress',
          category: 'Clothing',
          price: 60,
          image: 'https://mahezon.in/cdn/shop/files/IMG-20240729_195227_307_800x1026_crop_center@2x.jpg?v=1722262985',
          description: 'An elegant and comfortable dress perfect for any occasion. Its flowing silhouette and lightweight fabric make it a wardrobe staple. Available in multiple colors.',
        },
        {
          id: 'p5',
          title: 'Coffee Maker',
          category: 'Home',
          price: 90,
          image: 'https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcSqDVEIoJfTErWxNWlp6RFmn7NXqe-uAiFuV6u8YxNYPLTZDZg6R435JC7WsvB-lIA61-Q8NeqkO2FpOFdWbCv7bWg05opiJ8w1avx2l13l_iE3lZTJC1CAwg',
          description: 'Brew delicious, professional-grade coffee at home with this sleek and easy-to-use coffee maker. Features a programmable timer and automatic shut-off.',
        },
        {
          id: 'p6',
          title: 'LED Desk Lamp',
          category: 'Home',
          price: 40,
          image: 'https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcSmhrOoFck1lba6J6IFoHbcqpZRbOhCPmYeNprLFxnMTuyV9rhUyfmxr4pDxtcSGxxYJ66Nc3MeCO2AAs9Tkbss6QqHCxfWWNV_53HkZuQh',
          description: 'A modern and energy-efficient LED desk lamp with adjustable brightness settings. Ideal for reading, studying, or working from home. Its minimalist design fits any decor.',
        },
        {
          id: 'p7',
          title: 'Science Fiction Novel',
          category: 'Books',
          price: 15,
          image: 'https://rukminim2.flixcart.com/image/704/844/k6xxua80/book/0/5/7/science-fiction-stories-original-imafpab38e8geynu.jpeg?q=90&crop=false',
          description: 'A gripping science fiction novel that takes you on a thrilling adventure through time and space. A must-read for fans of the genre with an unexpected twist.',
        },
        {
          id: 'p8',
          title: 'Cooking Recipe Book',
          category: 'Books',
          price: 25,
          image: 'https://cdn.loveandlemons.com/wp-content/uploads/2023/01/cookbook3.jpg',
          description: 'Discover new flavors and master classic dishes with this comprehensive cooking recipe book. Featuring easy-to-follow instructions and stunning photography.',
        },
      ];

      // Data storage keys
      const STORAGE_WISHLIST = 'shopEasy_wishlist';
      const STORAGE_CART = 'shopEasy_cart';

      // DOM Elements
      const productGrid = document.getElementById('product-grid');
      const categoryFilter = document.getElementById('category-filter');
      const priceRange = document.getElementById('price-range');
      const priceValue = document.getElementById('price-value');
      const searchInput = document.getElementById('search-input');
      const suggestionsBox = document.getElementById('suggestions');

      const wishlistBtn = document.getElementById('wishlist-btn');
      const wishlistModal = document.getElementById('wishlist-modal');
      const wishlistList = wishlistModal.querySelector('.wishlist-list');
      const wishlistCount = document.getElementById('wishlist-count');

      const cartBtn = document.getElementById('cart-btn');
      const cartModal = document.getElementById('cart-modal');
      const cartList = cartModal.querySelector('.cart-items');
      const cartCount = document.getElementById('cart-count');
      const cartTotal = document.getElementById('cart-total');
      const paymentStatusMessage = document.getElementById('payment-status-message');
      const cardPayBtn = document.getElementById('card-pay-btn');
      const qrPayBtn = document.getElementById('qr-pay-btn');

      const quickviewModal = document.getElementById('quickview-modal');
      const quickviewTitle = quickviewModal.querySelector('#quickview-title');
      const quickviewImg = quickviewModal.querySelector('.quickview-img');
      const quickviewCategory = quickviewModal.querySelector('#quickview-category');
      const quickviewDescription = quickviewModal.querySelector('#quickview-description');
      const quickviewPrice = quickviewModal.querySelector('#quickview-price');
      const quickviewQty = quickviewModal.querySelector('#quickview-qty');
      const quickviewAddcartBtn = quickviewModal.querySelector('#quickview-addcart-btn');

      const loginBtn = document.getElementById('login-btn');
      const loginModal = document.getElementById('login-modal');
      const loginForm = document.getElementById('login-form');
      const loginError = loginModal.querySelector('.login-error');
      
      const signupModal = document.getElementById('signup-modal');
      const signupForm = document.getElementById('signup-form');
      const signupError = signupModal.querySelector('.signup-error');
      const showSignupLink = document.getElementById('show-signup');
      const showLoginLink = document.getElementById('show-login');

      const contactBtn = document.getElementById('contact-btn');
      const contactModal = document.getElementById('contact-modal');
      const contactForm = document.getElementById('contact-form');
      
      const messageModal = document.getElementById('message-modal');
      const messageTitle = messageModal.querySelector('#message-title');
      const messageText = messageModal.querySelector('#message-text');
      
      const qrScannerModal = document.getElementById('qr-scanner-modal');
      const qrTimer = document.getElementById('qr-timer');
      const cardModal = document.getElementById('card-modal');
      const cardForm = document.getElementById('card-form');
      

      const floatingCartBtn = document.getElementById('floating-cart-btn');
      const floatingCartCount = document.getElementById('floating-cart-count');

      // State
      let wishlist = new Set(JSON.parse(localStorage.getItem(STORAGE_WISHLIST) || '[]'));
      let cart = JSON.parse(localStorage.getItem(STORAGE_CART) || '{}'); // { productId: { qty, ...productData } }

      // Filter state
      let activeCategories = new Set();
      let maxPrice = Number(priceRange.value);
      let searchTerm = '';

      // Accessibility helper: trap focus inside modal
      function trapFocus(element) {
        const focusableElements = element.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (focusableElements.length === 0) return;

        let first = focusableElements[0];
        let last = focusableElements[focusableElements.length - 1];

        function handleKey(e) {
          if (e.key === 'Tab') {
            if (e.shiftKey) {
              if (document.activeElement === first) {
                e.preventDefault();
                last.focus();
              }
            } else {
              if (document.activeElement === last) {
                e.preventDefault();
                first.focus();
              }
            }
          }
          if (e.key === 'Escape') {
            closeAllModals();
          }
        }
        element.addEventListener('keydown', handleKey);
        return () => element.removeEventListener('keydown', handleKey);
      }

      // Close all modals
      function closeAllModals() {
        [wishlistModal, cartModal, quickviewModal, loginModal, signupModal, contactModal, messageModal, qrScannerModal, cardModal].forEach(modal => {
          modal.classList.remove('active');
          modal.setAttribute('aria-hidden', 'true');
        });
        document.body.style.overflow = '';
      }

      // Open modal helper
      function openModal(modal) {
        closeAllModals();
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        // Focus first focusable inside modal
        setTimeout(() => {
          const focusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (focusable) focusable.focus();
          trapFocus(modal);
        }, 100);
      }
      
      function showMessageModal(title, message) {
        messageTitle.textContent = title;
        messageText.textContent = message;
        openModal(messageModal);
      }
      
      // Open QR modal with timer
      function openQrModal() {
          openModal(qrScannerModal);
          let timeLeft = 30;
          qrTimer.textContent = `Time remaining: ${timeLeft} seconds`;

          const timer = setInterval(() => {
              timeLeft--;
              qrTimer.textContent = `Time remaining: ${timeLeft} seconds`;
              if (timeLeft <= 0) {
                  clearInterval(timer);
                  closeAllModals();
                  showMessageModal('Payment Successful!', 'QR code scanned. Your order is confirmed!');
                  
                  // Clear cart after a successful transaction
                  cart = {};
                  saveCart();
                  renderCart();
              }
          }, 1000);
      }

      // Format price helper
      function formatPrice(num) {
        return num.toFixed(2);
      }

      // Save wishlist
      function saveWishlist() {
        localStorage.setItem(STORAGE_WISHLIST, JSON.stringify(Array.from(wishlist)));
      }

      // Save cart
      function saveCart() {
        localStorage.setItem(STORAGE_CART, JSON.stringify(cart));
      }

      // Render products with current filters
      function renderProducts() {
        productGrid.innerHTML = '';
        const filtered = products.filter(p => {
          const categoryMatch = activeCategories.size === 0 || activeCategories.has(p.category);
          const priceMatch = p.price <= maxPrice;
          const searchMatch = p.title.toLowerCase().includes(searchTerm.toLowerCase()) || p.description.toLowerCase().includes(searchTerm.toLowerCase());
          return categoryMatch && priceMatch && searchMatch;
        });

        if (filtered.length === 0) {
          productGrid.innerHTML = `<p style="grid-column:1/-1; text-align:center; font-style: italic; color: var(--color-text-light);">No products found matching your criteria.</p>`;
          return;
        }

        filtered.forEach(product => {
          const card = document.createElement('article');
          card.className = 'product-card';
          card.setAttribute('tabindex', '0');
          card.setAttribute('aria-labelledby', `title-${product.id}`);
          card.innerHTML = `
            <img src="${product.image}" alt="${product.title}" loading="lazy" />
            <div class="product-info">
              <h2 class="product-title" id="title-${product.id}">${product.title}</h2>
              <p class="product-category">${product.category}</p>
              <p class="product-price">$${formatPrice(product.price)}</p>
            </div>
            <div class="card-actions">
              <button class="btn btn-view" aria-label="Quick view ${product.title}" data-id="${product.id}">Quick View</button>
              <button class="btn btn-wishlist ${wishlist.has(product.id) ? 'active' : ''}" aria-pressed="${wishlist.has(product.id)}" aria-label="Add to wishlist ${product.title}" data-id="${product.id}">‚ù§</button>
            </div>
          `;
          productGrid.appendChild(card);
        });
      }

      // Render wishlist modal
      function renderWishlist() {
        wishlistList.innerHTML = '';
        if (wishlist.size === 0) {
          wishlistList.innerHTML = '<p style="text-align:center;">Your wishlist is empty.</p>';
          wishlistCount.textContent = '0';
          return;
        }
        wishlistCount.textContent = wishlist.size.toString();
        Array.from(wishlist).forEach(id => {
          const product = products.find(p => p.id === id);
          if (!product) return;
          const item = document.createElement('div');
          item.className = 'wishlist-item';
          item.innerHTML = `
            <img src="${product.image}" alt="${product.title}" />
            <div class="wishlist-item-info">
              <h4>${product.title}</h4>
              <p>$${formatPrice(product.price)}</p>
            </div>
            <button aria-label="Remove ${product.title} from wishlist" data-id="${product.id}">&times;</button>
          `;
          wishlistList.appendChild(item);
        });
      }

      // Render cart modal
      function renderCart() {
        cartList.innerHTML = '';
        const productIds = Object.keys(cart);
        const totalItems = productIds.reduce((sum, id) => sum + cart[id].qty, 0);
        cartCount.textContent = totalItems.toString();
        floatingCartCount.textContent = totalItems.toString();

        if (productIds.length === 0) {
          cartList.innerHTML = '<p style="text-align:center;">Your cart is empty.</p>';
          cartTotal.textContent = '0.00';
          paymentStatusMessage.textContent = '';
          return;
        }

        let total = 0;
        productIds.forEach(id => {
          const item = cart[id];
          const product = products.find(p => p.id === id);
          if (!product) return;
          const subtotal = product.price * item.qty;
          total += subtotal;

          const cartItem = document.createElement('div');
          cartItem.className = 'cart-item';
          cartItem.innerHTML = `
            <img src="${product.image}" alt="${product.title}" />
            <div class="cart-item-info">
              <h4>${product.title}</h4>
              <p>$${formatPrice(product.price)}</p>
            </div>
            <div class="cart-item-controls">
              <button class="qty-btn" data-action="decrease" data-id="${id}" aria-label="Decrease quantity of ${product.title}">-</button>
              <input type="number" value="${item.qty}" min="1" data-id="${id}" aria-label="Quantity of ${product.title}" readonly />
              <button class="qty-btn" data-action="increase" data-id="${id}" aria-label="Increase quantity of ${product.title}">+</button>
              <button data-id="${id}" class="remove-from-cart-btn" aria-label="Remove ${product.title} from cart">&times;</button>
            </div>
          `;
          cartList.appendChild(cartItem);
        });
        cartTotal.textContent = formatPrice(total);
      }

      // Event Listeners
      document.addEventListener('click', (e) => {
        // Close modals on backdrop click
        if (e.target.classList.contains('modal-backdrop')) {
          closeAllModals();
        }

        // Close modal buttons
        if (e.target.classList.contains('modal-close')) {
          closeAllModals();
        }

        // Product actions
        if (e.target.classList.contains('btn-view')) {
          const productId = e.target.dataset.id;
          const product = products.find(p => p.id === productId);
          if (product) {
            quickviewTitle.textContent = product.title;
            quickviewImg.src = product.image;
            quickviewImg.alt = product.title;
            quickviewCategory.textContent = product.category;
            quickviewDescription.textContent = product.description;
            quickviewPrice.textContent = `$${formatPrice(product.price)}`;
            quickviewQty.value = 1;
            quickviewAddcartBtn.dataset.id = productId;
            openModal(quickviewModal);
          }
        }

        // Wishlist button on product card
        if (e.target.classList.contains('btn-wishlist')) {
          const productId = e.target.dataset.id;
          if (wishlist.has(productId)) {
            wishlist.delete(productId);
            e.target.classList.remove('active');
            e.target.setAttribute('aria-pressed', 'false');
          } else {
            wishlist.add(productId);
            e.target.classList.add('active');
            e.target.setAttribute('aria-pressed', 'true');
          }
          saveWishlist();
          renderWishlist();
        }

        // Quickview add to cart
        if (e.target.id === 'quickview-addcart-btn') {
          const productId = e.target.dataset.id;
          const qty = parseInt(quickviewQty.value, 10);
          if (qty > 0) {
            if (cart[productId]) {
              cart[productId].qty += qty;
            } else {
              const product = products.find(p => p.id === productId);
              cart[productId] = { ...product, qty };
            }
            saveCart();
            renderCart();
            closeAllModals();
            showMessageModal('Added to Cart', `${quickviewQty.value}x of ${quickviewTitle.textContent} has been added to your cart.`);
          }
        }

        // Wishlist modal remove button
        if (e.target.classList.contains('wishlist-item') && e.target.tagName === 'BUTTON') {
          const productId = e.target.dataset.id;
          wishlist.delete(productId);
          saveWishlist();
          renderWishlist();
          renderProducts(); // Update heart icon on main grid
        }
        
        // Cart quantity buttons
        if (e.target.classList.contains('qty-btn')) {
          const productId = e.target.dataset.id;
          const action = e.target.dataset.action;
          if (cart[productId]) {
            if (action === 'increase') {
              cart[productId].qty++;
            } else if (action === 'decrease' && cart[productId].qty > 1) {
              cart[productId].qty--;
            }
            saveCart();
            renderCart();
          }
        }

        // Cart remove button
        if (e.target.classList.contains('remove-from-cart-btn')) {
          const productId = e.target.dataset.id;
          delete cart[productId];
          saveCart();
          renderCart();
        }
      });
      
      // Header button handlers
      wishlistBtn.addEventListener('click', () => openModal(wishlistModal));
      cartBtn.addEventListener('click', () => openModal(cartModal));
      loginBtn.addEventListener('click', () => openModal(loginModal));
      contactBtn.addEventListener('click', () => openModal(contactModal));
      floatingCartBtn.addEventListener('click', () => openModal(cartModal));

      // Filter events
      categoryFilter.addEventListener('change', (e) => {
        if (e.target.checked) {
          activeCategories.add(e.target.value);
        } else {
          activeCategories.delete(e.target.value);
        }
        renderProducts();
      });

      priceRange.addEventListener('input', (e) => {
        maxPrice = Number(e.target.value);
        priceValue.textContent = `$${maxPrice}`;
        renderProducts();
      });

      searchInput.addEventListener('input', () => {
        searchTerm = searchInput.value.trim();
        if (searchTerm.length > 0) {
          const matches = products.filter(p => p.title.toLowerCase().includes(searchTerm.toLowerCase()));
          suggestionsBox.innerHTML = '';
          matches.forEach(p => {
            const div = document.createElement('div');
            div.textContent = p.title;
            div.setAttribute('role', 'option');
            div.setAttribute('data-id', p.id);
            suggestionsBox.appendChild(div);
          });
          suggestionsBox.style.display = 'block';
        } else {
          suggestionsBox.style.display = 'none';
        }
        renderProducts();
      });

      suggestionsBox.addEventListener('click', (e) => {
        const selectedText = e.target.textContent;
        searchInput.value = selectedText;
        searchTerm = selectedText;
        suggestionsBox.style.display = 'none';
        renderProducts();
      });
      
      // Form submissions
      loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          // Simulate login
          const username = document.getElementById('login-username').value;
          const password = document.getElementById('login-password').value;
          if (username === 'test' && password === '123') {
              showMessageModal('Login Successful!', 'Welcome back, ' + username + '!');
          } else {
              loginError.textContent = 'Invalid username or password.';
          }
      });
      
      signupForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const email = document.getElementById('signup-email').value;
          const password = document.getElementById('signup-password').value;
          const confirmPassword = document.getElementById('signup-confirm-password').value;
          
          if (password !== confirmPassword) {
              signupError.textContent = 'Passwords do not match.';
              return;
          }
          
          // Simple validation and success message
          if (email && password) {
              showMessageModal('Account Created', 'Your account has been created successfully. You can now login.');
              signupForm.reset();
          } else {
              signupError.textContent = 'Please fill out all fields.';
          }
      });
      
      contactForm.addEventListener('submit', (e) => {
        e.preventDefault();
        // Simulate contact form submission
        const name = document.getElementById('contact-name').value;
        const email = document.getElementById('contact-email').value;
        const message = document.getElementById('contact-message').value;

        if (name && email && message) {
          contactForm.reset();
          showMessageModal('Thank You!', `Hello ${name}, your message has been received. We will get back to you soon.`);
        }
      });
      
      cardForm.addEventListener('submit', (e) => {
          e.preventDefault();
          // Simulate card payment
          closeAllModals();
          showMessageModal('Payment Successful!', 'Your payment has been processed. Thank you for your purchase!');
          
          // Clear cart on successful purchase
          cart = {};
          saveCart();
          renderCart();
      });
      
      // Link between login and signup modals
      showSignupLink.addEventListener('click', () => openModal(signupModal));
      showLoginLink.addEventListener('click', () => openModal(loginModal));
      
      // Payment option handlers
      cardPayBtn.addEventListener('click', () => openModal(cardModal));
      qrPayBtn.addEventListener('click', () => {
          openQrModal();
      });


      // Initial render
      renderProducts();
      renderWishlist();
      renderCart();
    })();
  </script>
</body>
</html>